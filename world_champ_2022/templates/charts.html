{% extends "includes/layout.html" %}
{% load static %}
{% block title %}Таблица результатов{% endblock %}

{% block navbar %} {% include "includes/navbar.html" with active_tab='results' %} {% endblock %}

{% block h1 %}<h1>Результаты</h1>{% endblock %}

{% block content %}

<script src="https://code.highcharts.com/highcharts.js" type="text/javascript"></script>
<script src="https://code.highcharts.com/modules/exporting.js" type="text/javascript"></script>
<script src="https://code.highcharts.com/modules/data.js" type="text/javascript"></script>
<script src="https://code.highcharts.com/modules/drilldown.js" type="text/javascript"></script>

<script>
	$(function () {
		$('#container').highcharts({
			title: {
				text: 'График состязания',
				x: -20 //center
			},
			xAxis: {
				categories: [
				'',
				{% for msg in match_score_guesses %}
					{% if msg.match.penalty_score_1 != None %}
						{% if msg.match.extra_score_1 != None %}
					'{{msg.match.command_1.name}} - {{msg.match.command_2.name}} ({{msg.match.score_1}} : {{msg.match.score_2}}, ДВ {{msg.match.extra_score_1}} : {{msg.match.extra_score_2}}, пен. {{msg.match.penalty_score_1}} : {{msg.match.penalty_score_2}})',
						{% else %}
					'{{msg.match.command_1.name}} - {{msg.match.command_2.name}} ({{msg.match.score_1}} : {{msg.match.score_2}}, пен. {{msg.match.penalty_score_1}} : {{msg.match.penalty_score_2}})',
						{% endif %}
					{% else %}
						{% if msg.match.extra_score_1 != None %}
					'{{msg.match.command_1.name}} - {{msg.match.command_2.name}} ({{msg.match.score_1}} : {{msg.match.score_2}}, ДВ {{msg.match.extra_score_1}} : {{msg.match.extra_score_2}})',
						{% else %}
					'{{msg.match.command_1.name}} - {{msg.match.command_2.name}} ({{msg.match.score_1}} : {{msg.match.score_2}})',
						{% endif %}
					{% endif %}
				{% endfor %}
					]
				
			},
			yAxis: {
				title: {
					text: 'Очки'
				},
				tickInterval: 1,
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},
			tooltip: {
				useHTML: true,
				formatter: function() {
					if (this.point.prediction == 'firstPoint')
						return '<b>' + this.series.name + '</b>'
					return '<span style="font-size: 15px">' + this.series.name + '</span>' + 
					'<br><b>Матч: </b>' + this.point.match + 
					'<br><b>Счёт: </b>' + this.point.match_score +
					'<br><b>Прогноз: </b>' + this.point.prediction +
					'<br><b>Заработанные очки: </b>' + this.point.earned_points
					;
				}
			},
			legend: {
				useHTML: true,
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'middle',
				borderWidth: 0
			},
			series: [
			{% for chart_element in chart_data %}
			{
				name: '{{chart_element.user.first_name}} {{chart_element.user.last_name}} {% if chart_element.user.player.money %}<img src="{% static "coins.png" %}" class="coin_icon"/>{% endif %}',
				data: [
				{y : 0, prediction : 'firstPoint'},
				{% for data in chart_element.data %}
				{ y : {{data.score}}, prediction : '{{data.prediction}}', match:  '{{data.match}}', match_score: '{{data.match_score}}', earned_points: '{{data.earned_points}}'},
				{% endfor %}
				]
			},
			{% endfor %}
			],
			responsive: {
				rules: [{
					condition: {
						maxWidth: 500
					},
					chartOptions: {
						legend: {
							align: 'center',
							verticalAlign: 'bottom',
							layout: 'horizontal'
						}
					}
				}]
			}
		});
	});
</script>

<br/>
<br/>
<div id="container" style="height: 600px; margin: 0 auto"></div>
<br/>
<br/>


<hr class="my-4">
<br/>
<div style="max-height: 800px; overflow:auto;">
</div>

<br/>
{% endblock %}
